package co.ledger.wallet.core.device.ethereum

import co.ledger.wallet.core.device.ethereum.LedgerCommonApiInterface.{LedgerApiException, LedgerApiUnknownErrorException}
import co.ledger.wallet.core.utils.logs.Logger
import co.ledger.wallet.core.utils.{BytesReader, HexUtils}
import com.sun.net.httpserver.Authenticator.Failure

import scala.concurrent.Future
import scala.scalajs.js.timers._
import scala.util
import scala.util.Failure


/**
  *
  * LedgerBolosApi
  * ledger-wallet-ethereum-chrome
  *
  * Created by Pierre Pollastri on 24/06/2016.
  *
  * The MIT License (MIT)
  *
  * Copyright (c) 2016 Ledger
  *
  * Permission is hereby granted, free of charge, to any person obtaining a copy
  * of this software and associated documentation files (the "Software"), to deal
  * in the Software without restriction, including without limitation the rights
  * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  * copies of the Software, and to permit persons to whom the Software is
  * furnished to do so, subject to the following conditions:
  *
  * The above copyright notice and this permission notice shall be included in all
  * copies or substantial portions of the Software.
  *
  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  * SOFTWARE.
  *
  */
trait LedgerBolosApi extends LedgerCommonApiInterface {
  import LedgerBolosApi._

  def needFix(): Future[Boolean] = {
    println("need fix called")
    sendApdu(0xE0, 0x01, 0x00, 0x00, 0x00, 0x00) map {(result) =>
      matchErrorsAndThrow(result)
      val version = new FirmwareVersion(result.data)
      if (version.intTargetId == 0x01000001) {
        true
      } else {
        false
      }
    }
  }

  def isClubcoin(): Future[Boolean] = {
    println("testing if it is clubcoin device")
    val clubcoinTestApdu: Array[String] = Array(
      "e00400000431100002",
      "e050000008e46c4c718bc87fb7",
      "e05180008a4104c98ca09953472b36061e0e40c93d505234090efd74f1d7a293e828159a97711b33d18afc17ad156eaed99cf43b20e15d64af39a5513b4e3c5f4317e642702f05473045022100f1d2b834994a0c1f25ea20cf33e32bd06bcf7c424a02eee8f6969920e1e8c2b30220632d19bd30ab2076187878aeaa0f4d4804013279d016deca6693f37b4e507f43"
    )
    sendApdu(HexUtils.decodeHex(clubcoinTestApdu(0))) flatMap { (result) =>
      sendApdu(HexUtils.decodeHex(clubcoinTestApdu(1))) map { (result2) =>
        if (result2.sw == 0x9000) {
          true
        } else {
          false
        }
      }
    } recover {
      case all => false
    }
  }

  def getFirmwareVersion(): Future[FirmwareVersion] = {
    println("get firmware version")
    sendApdu(0xE0, 0x01, 0x00, 0x00, 0x00, 0x00) map {(result) =>
      matchErrorsAndThrow(result)
      new FirmwareVersion(result.data)
    }
  }

  def fixMcu(): Future[Unit] = {
    println("fixmcu")
    getFirmwareVersion() flatMap((result) =>{
      val mcu11Apdus: Array[String] = Array(
        "e00400000401000001",
        "e0000000050508003000",
        "e0000000ef06000000180020c1300008fd540008fd540008fd540008fd540008fd54000800000000000000000000000000000000fd540008fd54000800000000fd540008394a0008fd540008fd540008fd540008fd540008fd540008fd540008fd540008d14a0008fd540008fd540008fd540008fd540008fd540008fd54000800000000fd54000800000000fd5400080000000000000000fd54000800000000fd540008fd540008fd540008fd540008fd540008fd540008fd540008fd540008fd540008294a0008002110b5044b054a934201d202c3fbe701f070fd10bdc046000000204008002013b501248c408a404b1c0193",
        "e0000000ef0600ec0368a3431a43026013bd0000f0b51f4c020089b00e0020000021fff7ebff022209250292236893432360013dedb20623002d18d02027049323683200bb4323607f239a430192019a0721531e9a410f48fff7d0ff0623039323687600bb431f432760f6b2e1e720220793236893431e3a23600692236893431343013a2360059223689343236009b0f0bdc0461400004810b501000020fff7b9ff10bd10b501000120fff7b3ff10bd0022014b1a60704734020020014b18607047c04630020020014b18607047c04610000020014b18607047c04628000020f8b51f4d2b68002b39d01e4ba7201b68002b00d1",
        "e0000000ef0601d8a620fff7cfff1b4b1b68b42b04d0c020fff7c8ffa02003e0c820fff7c3ffa120fff7c0ff8120fff7bdffff20124b64211b680024584303f007f9c0b2fff7b2ff5020002640422043c0b2fff7abff0b4fe301ff18b85d0136fff7aaff802ef9d10134042cecd100232b60f8bd1400002030020020100000202800002030000020f0b500268db00d00b04200d0e2e050277f4238003043c0b2fff784ff80240020013cfff785ff002cf9d10136042ef0d12b786a781b0213430293ab78ea781b0213430593644b01941b6803940693029bdb0807932300013b00935f4b069a1868059b9b18834200d8b2e0069b",
        "e0000000ef0602c40599c01a029b0024584303f0a7f8079bc708db1b08930723ff22184001331b1a1a41089b524edb01f61807230b92029a1340099309331b1a0a93502040422043c0b2fff739ff0b9b0493a74201d0ff2304933500803d089b00221919022903d86b1cff331a7812042b0080331b781b021a430023994200d02b78134318000a9ad040049a1040009aa24204d1039ad340019a13401843c0b20135fff713ffb542d9d1803501342e00a742c6d22f4b029a1868069b0599c01a20239b1a584303f04df80325c4082b1b072700930823ff220740db1b9a40079b0892e418244be4011c19009b9d4282d350204042",
        "e0000000ef0603b02843c0b2fff7e2fe079b009a9b1a0b93089b0193954201d0ff2301932600099a7b1c9b180393803e0b9b0022e918022903d8731cff331a781204330080331b781b021a430023994200d0337813431800039ad040019a1040002d04d10a9ad340049a13401843c0b20136fff7b5fea642dad1013d803cbee7fff7ccfe0db0f0bd3c08002030000020f0b53d4c8bb0029222683c4c039225683b4c3c4b226801241b68059104933a4b3a4e19683a4b34601b68049e0793394b394f1b6808920193384b06941b68029a002a4ad08446059a127809926246141a002911db002e0fdb099ae2401400069a1440089a",
        "e0000000ef06049ca400a458002c02d0fc5c2c4301e0fc5cac43fc54039a0133013693421adb0722019b0131013b0193cb1713405b18db109340049a214c9b18079a0c409a180392002c04da0822013c524214430134069d049ea540019a002a0dd0029a121a02926246072a03d8029a8444002abcd1059a01320592b1e70b4a11600d4a019911600d4a1360034b039a1a60034b1d600bb0f0bdc046180000201c000020240000200400002008000020140000202c0000200c00002030000020200000200700008070b57f2833dc1f2931dc8418802c01d98022121acc18202c01d920235b1a0724cd172c406418e410114de401",
        "e0000000ef0605882418286010480160104802601048a2180360104b1c60104b1a60104b194004d5082301395b421943013101238b400c4a07991360059a0b4b06981a60089afff737ff70bd04000020080000202c0000200c0000202000002018000020070000801c00002024000020f0b585b00290c81880283ed800293cdb0a981018202838d8002a36db07240127a4460a9d3e005d4300956546bc46d010c00114404018a6401c180194144c03952760144c009d002d1fd0029d275c002d01d0374300e0b743019d2754013085420dd86746039e01321640b7403e000a9801380a90d010c00140181d180195009d013d0095",
        "e0000000ef0606740a9d002ddcd105b0f0bdc04614000020300000201823534310b5183bc918002a06d00b001c68013a18398442f7d100e01300180010bd0000084b10b51a68084c03051b0d511e002a06d08a00a0580a0001688b42f6d100e0100010bd2c6700083c7a0008f0b585b0029101921c00fff7e3ff071e38d00025019b1b190393019b039a93422fd0019b1c78013301933b899c4202d37a89944219d90a2c23d00d2c21d0bf2c02d93f26264014e000267f2c11d920202040431e98410e30fff7bcffb04208d01f231c40a400c36802e0e41afb68a400e65c029bae19002b01d09e4201dcb5b2cbe7280005b0f0bd",
        "e0000000ef060760f0b59db00cad0991079208930c926960fff79cff071e00d1ebe00379012b0fd8239a089b9446249a634494460a93269a229b634494460993259b63440b9356e001249c4040220021280002f077ff079b09992b60631e9a00515100220a93a31e06920b93069b099e079cde40ff231e40069bdc40ff231c40331ea34200da2300301ea04200dd2000181a01300a9902f017fea64204dc0b9b43439e1901231de0012324180a9a9a421bd99900221eff2a00ddff22069e0133b2406e58241832434a51efe79900321eff2a00ddff22069c0133a2406c58361a22434a510a9a9a42f0d8069b08330693182bbbd1",
        "e0000000ef06084c98e7089c259b0b9a934278d0259b1e78013325933d89ae4202d37b899e422fd90a2e01d00d2e05d1099b229a9342e8d2130065e0bf2e06d93f2500227b7935402299069231e07f2e27d920203040431e98410e30fff704ff002821d01f25c3683540ad005d196a880369b979229e9a18437980798919091a00202d78069014e0fb68751bad005d196a883b692d789a18fb79229906937b7907e02299002201e0020022991500130006920a9e6019864207d22298099ec0182290181886421ed3089c002a10d0387903920caa01920122060082406e435e430290009204962a002000fff715fe06e000930a00",
        "e0000000ef0609382b0021000798fff757fe069bed18641982e7229b1804a4b220431db0f0bdf0b50e0001218fb0039214aa1278c91a0892159a0a91991a049100210290099305918a4205d0049a0499d217521ad20f059201251c000027049a013a0692b21a0b92049aaa1a0792039a013a0c92bc4200da16e1089b2b421ad0059b002b10d0039b3100fa18069b0095e31a16980d92fff713fe069ba119c91a0095049b0d9a03e0230031000c9a00950298fff705fe0222089b13421bd0039be218059b002b0fd0099ba34205d00095079b31001698fff7f3fd039b0095e218079bf118049b03e03b003100013a00950298fff7",
        "e0000000ef060a24e5fd089b5b071cd5331b0d93059b002b10d0039b311bfa18069b0095e31a16980d92fff7d3fd069a331b991a0095049b0d9a03e023000c9a0095311b0298fff7c5fd089b1b071ad5039be218059b002b0ed0099ba34205d0f11b0095079b1698fff7b4fd039b0095e2180b99049b03e03b00013af11b00950298fff7a7fd089bdb061bd5039bdb1b0d93059b002b0ed0069b0d9ae31a310000951698fff796fd069ba119c91a0095049b0d9a03e0230031000d9a00950298fff788fd089b9b061ad5039b1a1b059b002b0fd0099ba34205d00095079b31001698fff777fd039b00951a1b079bf118049b02e0",
        "e0000000ef060b103b00310000950298fff76afd089b5b061bd5039bdb1b0d93059b002b0ed0069b0d9ae31a311b00951698fff759fd069a331b991a0095049b0d9a03e023000d9a0095311b0298fff74bfd6b4620229b181b785bb2002b19da039b1a1b059b002b0ed0099ba34205d0f11b0095079b1698fff736fd039b00951a1b0b99049b02e03b00f11b00950298fff72afd0a9b0137002b06dc0a9a7b000133d3180a93220006e0621ebb1a0a995b000133cb180a930b9b0994013b0b93079b1400013307930c9b01330c93e5e60fb0f0bdf0b595b00d93037807920f9380230f9a04009a4306910b92052a00d11de2078b",
        "e0000000ef060bfc3800fff755fd00283dd083790c9343790e93069b002b3cd0079b002b3bd0e6886b4631000d9a64311b7f89b200923800069afff753fd079b311a0a93bb0b05009a030891012b09d080231b029a4203d176084008331a00e000230893c0239b011f4080235b019f4209d080239b019f4217d127890c9b7f08013f5b0801e027890c9bfb1a0ee00a90050003000e900c9004e0069b00e0079b1d000a930993089301e0002309930b9b581e062800d95ae202f0aefb070055010700b401c30142025501e3882089e27a59084508a94200d20d00954200d91500227b6e0094460421625e0227e15f67469b1b4919",
        "e0000000ef060ce80090012f52d06069fff77efc0423e25e0223e15e238952199b1b009360692b00fff772fc0423e25e0223e15ee3885219c918238901399b1b0093491b60692b00fff762fc0421625e0220215ea07ae38800909b1b20694919fff756fc0422a15e2289e3888a180220215ea07a9b1b009049192069013afff747fc0421625e0220215e2089a37a801b009052192069fff73bfc0221605e0421625ee188a37a411820895219861b013900961ae02069fff72bfc0423e25e0223e15e238952199b1b009320692b00fff71ffc0423e25e0223e15ee3885219c9182389491b9e1b2b0000962069fff710fc012d52d9",
        "e0000000ef060dd4237b0026012b03d0a37a9d4200d9ee1a0423e25e0223e15e636901960293c023009352192b0049192069fff7aafd0423e25e0223e15ee3885219c918a37a491bc91a6369019602933023009320692b00fff797fd0423e25e2389d218a37a521bd21a0223e15e6369019602930c23009349192b002069fff784fd0423e25e2389a07ad2180223e15ee388521bc9186369491b0293032301960093121a091a2b002069fff76efd0025a07ea8422cd00423e75eb84bb8491a68fff7fcfb061eae4222d0238b42689b0b022b00d11500f168b3688c46218958084908091ac9190227e05f089fc0196f08c01b6746",
        "e0000000ef060ec05f43574304977769039767460297366901960126be400096fff740fb069b002b00d13ee1079b002b00d13ae1238b22690a93217b6369012901d1190001e011001a000220235e08986d081b185b190b930423e75e02230998089e3f18e0889c46801ba67a002e01d073009c4663462489c01a099b451be41a0220002e00d070000d9b241a0593079b02940493069b0195039300970b9b0a985be0237b012b2bd10b9e0223e15e60690422a35e0c9a072e00d000220b9e9a1a0e9b072e00d023890093089bfff734fb089b0b9e5d190223e15e0423e25e606949190c9b072e00d00023e688d21a731b0b9d0e9e",
        "e0000000ef060fac072d00d026890096fff71cfb069b002b00d1d0e0079b002b00d1cce00225635f089d0b9f5b199c46208b216962690423e65e099d072f01d10c9d6d42089fad190b9be6882489f61b099f072b00d100270d9be41b05930a9b02940493069b0196039363460095fff7a5fba4e0e37a002b00d04ee60421625e0220215e2089e38800902069fff7defa95e00222a35e08930423e25e0992a07e002841d00f9b052b0ad10d9b002b07d0464b1968002903d0454b1a68002a02d1404b41491a68fff70dfb002877d0079bc768002b09d00423079abb4093426ed1960802d0069b002b04d10126be400369b6b20693",
        "e0000000ef061098836821895d0849084268e488491b099d640849195508641b089d64191d0055437d430495406902970390069800960190200017e0069b1978022916d92389e288180050434843049004208840069c01302018039010a80190012088400291009009990898fff72efa2fe001228a4006989300033bc318013ae0d31e7858783602064398783604000284466546d87897002843064310a83e50043bece7e37a0222a15e267b0425625f2069c918d2180025012e03d0a67ab34200d99d1b646901950294ff240094fff7fafb15b0f0bdc046ec7d0008d87a0008380200203c020020f0b5c36a99b004000b92002b",
        "e0000000ef06118402d08b4200d96ae1e2880c92002a00d165e1a27e002a00d161e1a26a120f042a00d15ce1002b08d17f22a07aa3620240642042435118e1626362e669002e00d14de1238c0993002b00d148e18022237893431f1e072f02d0022b00d03fe1238b18000693fff760fa0890002800d136e1e31cdb7f9b4a07930093002101230698fff768fa24226b469b181d78079b1790009332002b0000210698fff75bfa0c9a1090904200d81ae1089b099a9b790893636a934201d900236362636a079a0d93f3180e930d9b0092eb1adbb20e9a00210698fff73ffa079b139000930e9a012300210698fff736fac023069a",
        "e0000000ef0612709b01119013402089089a851a80225201934209d0802200259201934204d1089b4508013d5b08ed1aa36a109a1b011b090f939b1a1293129a139b944663440a9323690a991493636915930222a35e5b1a169329000423e65e072f01d1089b59420c9b8e191900119b9c460a9b6144cb189c460021072f00d02900179b0d9a01330c93079b411a0593099b02919b1a04930e9b159a03936346149901930096169b0698fff725fa0223e15e0c9b6069c91a0423e25e2b00072f01d1089b5b429a1800262389072f00d02e009b1b00930c9bfff756f90223e15ee3886069c9180423e25e2b00072f01d1089b5b42",
        "e0000000ef06135c9a1800262389072f00d02e009b1b00930c9bfff73ff9fef727fffa21a57e0b9f89006f43380002f04df80b9b5e006e431d00002808d1fa210b9b30008900ed18f61902f03ff8f4e78021a36a49051a0f12078a4221d002d8002a09d053e0802189058a4226d0c0239b059a423cd04ae0e26a5519e562119a0a9daa420bd8626ae58801326262129a5242aa4203d80f9b1943a16237e0c31834e07f23a27a134064225343e26ad318e36280230f9a9b05134327e0e26a5519e562119a0a9daa420cd8109a139daa4205d8c0239b05a3620023636217e0626a013a62621b011a09131a1943a1620ee07f236422",
        "e0000000ef061448a17a0b405343e26a49b2d318e3620023002901da8023db05a36219b0f0bdc0462867000870b501250f4b10491c680f2322680340aa4322600209aa40ab40505a0b4a2669995a01f0c7ffff2380b242005b00700018405043f73bff3b9843e06023681d43256070bd50040020547f0008347f0008084b1b689b0302d496235b0001e096239b00054a0549526808689b1a181a80b27047c046000002405800024070020020f8b507000c001500fff7e2ffa0422fd26b1cf9d0013d002df6d129e09622164d52002b682600d31a9c4201d32e68961b002f07d02b6811493800c918320002f06bf8bf192b68a41b",
        "e0000000ef061534f6182c232e602a68ff33a4b29a420bd98021094a890253680b43962153602868490001f0e9ff2960002cd3d1f8bdc046700200207402002000000240f8b505000c1e3dd09626012776007f42221eb24201d99622520040202b00ad18194a19499d4207d0176219781185d1690142fcd00133f4e7144acb691340902bfbd1fff783ffb44215d82100a04202d2fff77cff0100012289b252420020fff78dff231cb44201d9094b1b88e41aa4b2002ccdd106e02c23ff339842e8d996214900e8e7f8bdc0460038014090000100327f000870b505000e00fff757ff0228fbd90122032152422800fff767ff6b78",
        "e0000000ef061620a9781b020b43b21e9cb29a4201dc033eb4b2fff743ff8442fbd80122e81c210052420334fff752ffa0b270bd10b5fff78fff10bdf0b502279026794d794c85b0002128222800f605278002f017f81120fff7fcfe7269744b64201340736100f045ff80227369d200134380227361520239002800fff72aff04222b786e789343278000953b2b01d00024c5e0002503ab1d705d7001950f2733003a00bb434cd010231e4210d001225d4f2088524238180121fff70bff012d03d82388fa5c03ab5a55238801332380b3060ad50122009b2088524218180121fff7f8fe23880133238073060ad50122009b2088",
        "e0000000ef06170c524218180121fff7ebfe23880133238073b20026b342c8da0122009b2088524218180121fff7dcfe2388009a0135d65c01332380019bedb2002b05d10f3333405a1e9341dbb200e001230193ade7394d697839400ad0208889b22818103afff7bffe6b781f402388ff182780019b002b04d103ad6c78002c12d119e00122009b2088524218180121fff7aafe0022238801339bb223809342ebd90132d2b2fae7802c00d07ae72878fff75afe7f3c3de02e78112e39d0002e37d0022000f0a0feff231f4804210370ef3b4370213b86705e40c670fff7c6fe01221a4e524202213000fff77dfe3378ff2b00d0",
        "e0000000ef0617f856e7ee3b2b707378002b0ad0102b17d10122b01c52420221fff76cfeb3782b7005e00122b01c52420121fff763fe2b78982b01d1813b2b702878fff71bfe0124200005b0f0bdc04648020020a4030020fffbffffa003002044020020f0b55c4f89b05c4d002800d19ae08023902400265b000393fe3be40504930133069303a9023b20000793059600f094fe80239b000393ff3bff3b049303a9013b2000059300f088fe0822636903a993436361636920003b4063618123db00039301230493db1805930696079600f074fe0822636931009343636163691f4080236761aa69db011a43aa61aa693b4f1340",
        "e0000000ef0618e4019348223800019b01f0d6fe0121384b20201a683b608a431a60364a36491a60fc2292015a60802212019a6002221a61802252015e61da60012252421a625a680a400a215a609a688a439a6099680143996001211a6802431a60284a28481660284a1660284a16606a690a436a616a6980250a400292029a2c31244aff3151602349ed0091602349d160016829430160a32111609a6863390a439a601a683f390a431a6008226369982013436361fff75ffe15e09024e40563691b201f40676100f0f8fdab690c4a20001340ab61e023db000393032303a9049300f0f5fd012009b0f0bdfffbffff00100240",
        "e0000000ef0619d050040020003801400c940000ffbfffff7002002000000140a80300204002002058000240243801407402002010b50021fff728ff10bd0000bff34f8f024a034bda60bff34f8ffee70400fa0500ed00e010b572b6fff7f0ff10b5024801f006fa10bdc046980400201d4a1368083313601c4b1b68002b12d01b4b1a6808321a601a4a19681268914209d372b68020184900010a6802430a6062b600221a60154b5a68002a12d01a6808321a601a6908321a611a69632a09d972b680200c49c0020a6802430a6062b600221a610a4b1b68002b03d0094a1368083313607047c0463c080020380800202c080020",
        "e0000000ef061abcf4060020ac03002038040020b0030020f806002010b572b680211b4c63690b4211d06161194800f00bfe194b002806d11860197d5a680a435a60186103e0197d5a688a435a608021636909020b4213d090200d4bc005596100f0f2fd0c4b002806d11860597d5a680a435a60186103e0597d5a688a435a608021064ac90213680b43136062b610bd000401400004004838040020ac03002010b5094cb42806d10020fef725fb01232375db1805e0b420fef71efb02232375013b637510bdc04638040020002270b50d000400074b01001a60074b01321a600648023201f0f6fc29002000fff754fd70bdc046",
        "e0000000ef061ba8f8060020b0030020d8050020f0b5c94bc94a93b01a60c94ac94b01901a609020c02300240227c74d5b010da9c005ac600d936c600e942c600f97109400f0e2fc8023c14e9b02726990201a43726172690da913400893089b80231b020d93bb4bc0050e9301230f9300f0ccfc80237269db021a43726172690da913400993099b8023b3480d9300f0bdfc072000f0a6fc22003900072000f071fc220021001b2000f06cfc62b6ab4b20001c60aa4b1c60fef79cfa2000fef79ffa1420fef7a8fa2000fff773fffa20a44b40002c601c60ac606c602c6100f045fca14b01201c70fff7b8fe302221009e4801f0",
        "e0000000ef061c9403fd9e4b1b88052b5ad1380000f034fc01239b4d019a2b700a236c70ab70994b280093429b415b425b00eb7004222123954909302c716c71af71eb712a7201f059fc0d212800fff751ff01228f4b1a608f4b0b945c608f4b8f4ac0331c608f4bd31a01931b0e0393019b1b14dbb20493019b1b12dbb20593894b082219687e48fff730fa814b1f68012f00d1fbe1022ff2d1fff7c9fb06ab9d1d28802b88022b19d99621764c49002000fff761fc28806378a2781b0213430a932378662b01d0fff758fe0d2323700023032120006370a370fff70bff734c2368002bccd000230c932368802325685b031d40",
        "e0000000ef061d8039d01223634d674c2b70236803211b0adbb26b7023682800dbb2ab70fff7f0fe6368002b12d123680421043b23606b461b7b28002b706b461b7c6b706b461b7dab706b461b79eb70fff740fc2368002b06d06068564b2168c01889b2fff736fc22686368d3186360802301225b030c934b4b1a608be1802322689b011a4016d00c9301260f2343480421037045708670c670fff7b5fe72b6484b9d60dd602268474b1340236062b63d4b1e606fe18021236809020b4009d00c910f23012404213448037042708470c1700ee08021226849020a400ed00f222e480c91012402704370082304218470c370fff7",
        "e0000000ef061e6c89fe2c4b1c604ce12027236810263b4066d00b23244d2e706a70ab70ea7008220a3b2b716a7172b62b49a81d0d31ff3101f074fb012123682800bb432360244b9a688a439a609a68002a02d12268b24322600121da688a43da60db68002b04d11a4a1e4b11680b40136062b60e2166e0b4030020006cdc020030000800000020380400200010024000003110000400482c08002038080020b003002028080020c4060020a4030020fc060020b70b0000747f0008dc0500203008002000060020b07f0008000000083c080020ac030020e0050020cffffdff98040020fffffdff2268324036d0c64a91680029",
        "e0000000ef061f5830d01100012005009d408c68deb22c4225d010240021c048047041700331817080213143c1700221017172b61a314b43ba49cb181b6cdbb243719368ab4393609368002b03d1b64a1368a343136062b60621fff7e9fd0122b24b1a60aae60133042bd0d1102361e0802321689b020b405ed0a84bd968002956d0140001210f00a740d868e2b238424bd0a44ba64e1b68e0001d009b1996265035298876000918c95a8905890db14205d829884018c55aad05ad0d01e096256d001023964ee9b23370eb1c1b0adbb27370cb1cdbb2b3700423f2703000337171710621fff7a4fd1c235c438d482b0004199c34",
        "e0000000ef06204422883100006800f0e5fea9b23000fff7fbfa0122884b1a6072b6834bda68ba43da60db68002b04d1824a854b11680b40136062b648e60134042caad180239b020c9342e080222168d2017b4d11420dd00c920f227548012402704370022304218470c370fff76afd2c602ee023685b0318d572b6734b6d485b686e4a5b00dbb2c3701168704b0b40136062b60523012403700023042143708470fff74ffd664b1c6011e6634b1a6880231b011a4200d10ae60c930e235d4803210370002343708370fff73bfd01232b6072b6594a0c9913688b43ace7fff7cff906abd8809d1ddb88022b00d8efe59621504c",
        "e0000000ef06213049002000fff766fa288000256378a2781b0213430a93524b26001d602378dbb24f2b00d1d8e00ed8462b22d006d8322b00d177e13e2b00d196e1cfe54b2b18d04e2b18d0cae5652b2bd006d8502b00d12de1602b00d191e0c0e5662b00d198e1682b00d0bae5e078211dc0b2fef75cf88fe1fff73dfc0a9b022b00d0aee572b6e37822791b021343364a136013685a1e9341354a1360354b2b4a1d601168344b4fe70a9b1b2b00d898e50a9b029a9a4213d11c220a9b934200d80a9af11c2d4801f0a2f9002808d131000a9a1f311c3a294801f099f9002828d072b6254c30220021200001f042fa62b6154d",
        "e0000000ef06221c224e29000a9a1f311c3a300001f0aef91c220a9be6611c3b23840a9b26002900934200d80a9a0331300001f09ff90a9be1690293f31cdb7f228c3000fef7c0fc0d2304480321037000234370837030e1e0050020fc06002098040020ac030020dc05002006040000fffffdff38040020fffffbfff8060020f4060020380800202c080020fff7ffffc4060020b80300200a9b022b00d02be5e37822791b02134300d025e5fdf780ff0023012480250a930a9b1f2b14d821000a9b0b9a99400a420ad00a997d48294301f04ef821000a9a0b9b91408b430b930a9b01330a93e7e70222774b1a600022764b54e6",
        "e0000000ef062308e0780138032800d9fce4714d01f070f802101c282a000023b43213602a002800c032136000f084ff280000f0afffe9e42c00c0342368002b00d1e3e4280000f0acff00232360dde42b00c0331b68002b00d1d7e421792800c9b200f0ebffd1e4c0352b68002b00d1cce400235b4a0a9311790a9b994200d8c4e403210a9b4b430633d35c002b08d10a9b51484b430533d15cc9b200f0a6ff1ae003210a9b4b430633d35cff22013bdbb28b4201d84c4ad25c032103240a9b48484b430533c15c0a9bc9b263430733c35c414800f070ff0a9b0133cae73e480300c0331b68002b00d18fe42379dbb2302b25d0",
        "e0000000ef0623f415d8102b22d0202b00d085e4e1786379c9b2dbb2a21d334800f09eff7f23e1780b9a19407e3b8b4013430b9374e4402b07d0802b00d06fe4e178c9b200f074ff6ae4e178c9b200f05fff65e44022e1786379c9b2934200d8627900f09fff5be463792548002b00d0456021494268234ecd78234b0c7992192d029a1a2c43a24203d24268b6189b1b03e0cb780a791b021343194a136072b680211a4a490313680b43ede5e0783840fdf780fe2079c0b2fdf788fe0623e078184002d0042802d1b420fff74dfbfdf783fefff725fc0d230321200023706570a570fff757fbfff71bfcc04600060020dc050020",
        "e0000000ef0624e0b0030020fc060020787f00083008002000000008f87f0008ac030020fee70000014b18687047c0463c08002013b50190fff7f6ff0400fff7f3ff019b001b9842f9d313bd70b58901002814da0f23c0b20340083b114a9b0803249b009b18ff222040a04014000a4084408240dd69a5432a43da6111e08208094b03259200d218ff232840a8401d00c02485400b408340a4001659ae433343135170bd00ed00e000e100e01f2318401e3b8340014a13607047c04600e100e01f2318401e3b8340014ad3677047c04604e100e0f0b50b6887b0039300230291039ada4000d190e001229a40039c1440019400d1",
        "e0000000ef0625cc87e0029a1021526816008e43022e0ed107251d40ad000139a940dc08a4000419276a8f4302990969a9400f43276203245f00bc400321e4431140b9400568013e25400d430560012e10d802998568ce682540be40354301269e40012185604568b54316090e409e4035434560c56802992c408d688021bd4049052c43c4600a4247d00121254c0327a5691f400d43a5610f25a469bf000c400594059c20499c08a4006418bd409021a668c905ae430025884208d01b490135884204d01a490435884200d1033dbd40019935430e00a560164ccd4327683e43d10301d43e002e4026606768019e3e43910301d4",
        "e0000000ef0626b83e002e406660a768019e3e43d10201d43e002e40a660e668019f3743920201d42e403700e76001336ae707b0f0bdc046001002400000014000040048000800480004014000690840411e8841c0b27047f8b504000120002c3ed02500ff35ab7adbb2002b03d16b72200000f027fd2700032326002837ab72702200213800983600f0b0ff70220021300000f0abff00233800190001276268934205d003704770c17001331c30f7e700231900934204d03370f17001331c36f8e700200121236805349a1c9e1d5033d187d087f0871880024bd387e077a972f8bdc0460084ffff802203681202583319880020",
        "e0000000ef0627a40a431a8070470200ff32517a03000220012909d01b6819180138c88700200633d8870323cb87507270470100ff314a7a03000220012a07d000201a68583213885b045b0c138048727047020010b5ff32547a0223012c0cd0013b5372002904d1036880314c33198001e00530c17700235372180010bd0000f0b5050048b21c24002804da7f260e407443283401e04c4398342c197f26e3702b003140c00f60702170e260ff33597a0220012900d190e001215972e0782b68032819d82178454e8900591800f0c6fd020e070a08880640802080000ae00888064008e008880640c02002e0088806408020c000",
        "e0000000ef06289006430e802178394e8f00df19388830408446664636480143314389b239801f00617884460e0050372178a088002e1dd03a88c900591889188022d2008918012290430880227892009a181188490605d51188264e0e4027490e431680227892009b181988244a0a40202134e03e88c9008919224e591889190126b043088020783988c00040181e49591840183e2a08d95109d20601d1013989b21a4a8902114304e05108324200d0013189020180227892009a181188490405d511880b480140114801431180227892009b1819880f4a0a40c02189014a406146002011438ab2ff351a806872f0bd8f89ffff",
        "e0000000ef06297c0f0f00008080ffffc0800000bf8fffff04040000060400000080ffff80c000008fbfffff020048b270b51c23002804da7f240c406343283301e04b4398337f24d318214019701100c00f5870ff314c7a0220012c2fd00138487215681a785c7892001548aa18002c11d01488640605d51688124c3440124e344314801c78114aa4002c1923881a40030013430fe01488640405d51688094c34400b4e344314801c780a4aa4002c1923881340034300209bb22380487270bd8080ffff0f0f0000c0800000bf8fffff80c000008fbffffff0b505007f201c2401404c432c192000a83002602200ac3213600023",
        "e0000000ef062a682e0083600f38037001380170ff36777a0220012f44d001387072a43410682468a04203d9001b1060200000e013601c234b43eb181a00a23212782c68002a1dd122009833503217881a78164bd200d219e318d2183e2809d943099bb2c00601d1013b9bb210489b02034306e043089bb2c00701d501339bb29b0213801c2041436d1898352b7800209b00e4182288074b1340c02292015340054a134323807072f0bdc046060400000080ffff8fbfffff808000007f231940633b5943411828310b7802689b00d3181988044a0a4030214a4003490a431a807047c046bf8fffff8080000030b50400ff34637a",
        "e0000000ef062b5402000220012b37d0012348b263721b33002804da7f250d406b43283301e04b4398330125d3189d707e352940c50f5d7019701268114d002908d11188104b0b4010494b402b439bb2138013e0890051180a88002805da0c4b1340102253402b4306e00a4b1a4080235b015a402b0013439bb20b800020607230bdc0468080ffffbfbfffff10100000bf8fffff8fbfffff020048b270b51c23002804da7f240c406343283301e04b4398330024d3189c707f3421401970c10f59701100ff314c7a0220012c34d00138487215681a785c7892001848aa18002c13d01488640605d51688154c3440154e34431480",
        "e0000000ef062c401c78144ba4002c192288134030225a400300134312e01488640405d516880b4c34400d4e344314801c780c4aa4002c1923881a40c0239b015340034300209bb22380487270bdc0468080ffff0f0f0000c0800000bf8fffff80c000008fbfffff70b58024e40000190c0001335b108218002b08d0657826782d02601a354385520234013bf4e770bdf8b505007f201c2401404c432c192000a263e363002201232e002930226401384370ff360170777a02209f422cd07372e36b676bbb4202d9db1be36301e01f00e2631c246143bfb26c18a16ba28d28683b00fff7c1ff2d6828342b00227850331888d200",
        "e0000000ef062d2c094baa181218d21817802378074a9b00eb18198800200a4030214a4004490a431a807072f8bdc04602040000bf8fffff80800000f7b505007f201c2401404c432c19e3632300a2630126002229332264013b5e7019702b00ff335f7a7d38b7423dd05e72606be36b8446834202d91b1ae36301e09c46e26328680026030050331a881c23594369180f0028373b78db00c3189b18124a9b181e803b78114a9b00c3181c882240202462400f4c22431a8063466a46d380d4888a8d2300896bfff759ff296830000b0050331a883b78ff35db00cb189b18024a9b181c806e72febd02040000bf8fffff80800000",
        "e0000000ef062e1810b58024e40000190c0001335b108218002b05d0601a805a013b20800234f7e710bd0000f0b5036885b00633db8f04001bb2002b11db23680633da8f520500d467e1d98fb44a20000a40da8700f0d2f900212000fff7bffc5be102ab9f1d00233b80206803aa831ddb8f9bb213801bb2002be0da0f2315881d4000d0afe00188a64ba74e0b4020214b40802133439bb203800388a34d89012b404b4033439bb20380102311880196194027d102889e4b13402200038003002832127850331b88d2008018c018994ba26bc018038820009b059b0d2364d318a36300f079f9631dda7f002abdd0e06b0028bad1",
        "e0000000ef062f048022d97f114322684c321180d877b2e703889bb23b803b881b051dd5030022005033983219881378db00c3185b1885495b1821001b880d319b059b0d9361ff319288fff767ff22687f4b118820000b40138000f029f98ee73b881bb2002b00db89e70288784b2600134003800300983650331a883378db00c3189b18714a9b181b889b059b0db36109d03169002906d0b288fff73fff3369b2699b1833610021200000f00bf92168f0680b0050331a88644b8a18d2183e2809d943099bb2c00601d1013b9bb261489b02034306e043089bb2c00701d501339bb29b0213800b881d40c0239b015d40019b2b43",
        "e0000000ef062ff09db20d8041e7ab000193c3181a8892b23a803a8812b2002a4bda19884f4a0a401a800300503319881c236b43e3181a0098321278d20082185218474952181688b605b60d09d01a00a8321168002904d09c331a883300fff7e7fe1c2213006b43e3181800b0300168a833891901601968002901d0891919606a43a2181300ac331b68002b04d01100a43109688e4208d21c236b43e31898331978200000f098f807e010009832a830117802682000fff7d5fc80223b88134200d1e6e62068ab00c3181988224a0a401c211a8003006943503361181a880b0028331b78db00c3189b181c4a9b181b889b059b0d",
        "e0000000ef0630dc0b6403d08a8d896bfff7dcfd2068030050331a881c235d436519290028310b78db00c3189b18104a20009b181a88ab6b9205920d2a649a18eb6baa630978002b02d100f063f8aae6fff7d0fda7e605b0f0bdc046fffbffffbf8fffff8080ffff8fbfffff0f8fffff02040000060400008f0f00000080ffff10b51c220c0604d57f2421404a43283201e04a4398328118002088728b8010bd07b50b4b02689a4211d18023094a1b04d1691f201943d161d2690321134001930022019bfff7c4f91f20fff7f1f907bd005c00400010024072b62021024a13680b43136062b67047ac03002072b601238b408021",
        "e0000000ef0631c805488902c2681343044ac36013680b43136062b67047c046e0050020ac03002072b601238b401021044882681343044a836013680b43136062b67047e0050020ac030020fc3010b504000121006c00f0ebf8206c00f0caf872b68021034a890113680b43136062b610bdc046ac03002070b506780500002e21d1a022114c52003100200000f026fa2300fc331d640e4bc035236004232c6063602000023ba3602361fff74dfa4023320031002868fff76dff8023320019002868fff767ff002070bdc04698040020005c004010b5c0300068fff77dfa002010bdc03010b504000068fff790fa2068fff77bfa",
        "e0000000ef0632b4002010bdf8b51e007f23c0300d00170004000b40ca095b009b1801339b0189b200220068fff73cff3b00320029002068fff79afa0020f8bd10b5c0300068fff755fb002010bd0000064b10b51b689b0601d54b0603d0c0300068fff71dfc002010bdc046ac030020064b10b51b689b0601d54b0603d0c0300068fff759fc002010bdc046ac03002010b5c0300068fff754fa002010bd0000f8b57f2430270a4e0c403668a500761935883d40302dfbd0064d2d68ad0601d5002c03d0c0300068fff7f4fc0020f8bd98040020ac03002010b5c0300068fff7c7fb10bd1300074a10b51268920601d54a0604d0",
        "e0000000ef0633a0c03000220068fff751fb002010bdc046ac030020002270b50400402511004023fff77aff2b000022256680212000fff773ff230001229c3325621a7018331b68002b03d021795b6820009847002070bd017400207047000002b4714649084900095c49008e4402bc7047c04603b47146490840004900095a49008e4403bc7047002243088b4274d303098b425fd3030a8b4244d3030b8b4228d3030c8b420dd3ff22090212ba030c8b4202d31212090265d0030b8b4219d300e0090ac30b8b4201d3cb03c01a5241830b8b4201d38b03c01a5241430b8b4201d34b03c01a5241030b8b4201d30b03c01a5241",
        "e0000000ef06348cc30a8b4201d3cb02c01a5241830a8b4201d38b02c01a5241430a8b4201d34b02c01a5241030a8b4201d30b02c01a5241cdd2c3098b4201d3cb01c01a524183098b4201d38b01c01a524143098b4201d34b01c01a524103098b4201d30b01c01a5241c3088b4201d3cb00c01a524183088b4201d38b00c01a524143088b4201d34b00c01a5241411a00d20146524110467047ffe701b5002000f006f802bdc0460029f7d076e770477047c04630b5032a1ed903000b439b0711d004780d784b1c8a18ac4206d016e00133591e04780d78ac4210d101309342f6d1002030bd03680c68a342e9d1043a04300431",
        "e0000000ef063578032af6d8002ae2d1f1e7601bf0e7c04670b50f2a32d90c0004430b00a40731d115000400103d2d0901352d0149191e6826605e6866609e68a660de681033e66010349942f3d10f2345191340032b1bd91c1f0023a4080134a400ce58ee5004339c42fad103232d1909191a4005d00023cc5cec5401339a42fad170bd0500002af5d1fae70500f2e71a00f8e770b588420bd98b18984208d2991a531e002a03d0ca5cc254013bfbd270bd0f2a09d80500002af9d00023cc5cec5401339a42fad1f2e70c0004430b00a40726d115000400103d2d0901352d0149191e6826605e6866609e68a660de681033e660",
        "e0000000ef06366410349942f3d10f2445191440032c10d90023043ca4080134a400ce58ee5004339c42fad103232d1909191a40cae70500cae72200c6e7c04670b583073fd0541e002a3bd0ceb20300032503e0621e002c34d0140001335a1e16702b42f6d1032c24d9ff250d402a0215432a0415430f2c11d92600103e3609013636011a009b19156055609560d56010329342f8d10f221440032c0ad9261fb6080136b6001a009b1920c29342fcd103221440002c05d0c9b21c19197001339c42fbd170bd14000300cce757000000030000000900000001120d0020007f0094710008c4680008030500000305050004060a00",
        "e0000000ef063750070b100006091b00090e2400080c320002033e00030541000305460006094b000609540003055d00040662000305680004066d000609730006097c000609850006098e00080c97000609a3000609ac000609b5000609be000609c7000305d0000305d5000609da000609e3000609ec000508f5000a0ffd00070b0c01070b1701070b2201080c2d010609390106094201080c4b01080c57010305630104066801070b6e01060979010a0f8201080c9101090e9d01070bab01090eb601070bc4010609cf01070bd801080ce301070bef010a0ffa01060909020609120206091b020406240204062a0204063002",
        "e0000000ef06383c0609360205083f020609470206095002070b590205086402070b6c02060977020508800206098802070b910203059c020406a1020609a7020305b0020a0fb502070bc402070bcf02070bda02070be5020406f0020508f6020406fe02070b040306090f03090e18030609260306092f0305083803040640030609460304064f0306095503070b5e03000000000000000000902449022400008024491200000000000000000000004002092288f88f0412ff1141040924000000000000000020e0a1204102051c70204192c2030200000000000080414804892009248194614a20092441248884600000000000",
        "e0000000ef0639280000000000c0011188400414608044421294400cc3270000000000000090240000000000402422222222224400204244444444442200102040f08702051100000000000000000000000000000000800001823f081020000000000000000000000000000024050000000000000e000000000000000000000060060000002284082144081100000000007010112448902041820409228203000000000000002060a0000102040810204080000100000000000000780801020408101010101010e00f0000000000000078080104040c0f2080000102e203000000000000000004304001094820821084f01f2000",
        "e0000000ef063a1401080000000000000000f810204040800f6080000112c20300000000000000e030202040801e4382040922840700000000000000fc01020204080810102040408000000000000000007010112488080e2282040912c40700000000000000780811244890305e80000101c30100000000000000006600006006000000006600002022000000000000040683010c6000010000000000000000000000000000c01f0000fe000000000000000000000000000010c0000630180c0400000000000000000000000f08040241100402804000000000000000f880411020c49388242149481292c424ee080004000200",
        "e0000000ef063b001f00000000000000c000030c4820810421fc08249040010200000000000000f04108410411c2072104114410217c0000000000000000c087000102082080000208400002f00100000000000000e00321084220021188400422104108c1070000000000000000f811204080003f0204081020c00f00000000000000fc0404040404fc0404040404000000000000003f08400002200002207c022440048440f00300000000000000004020044220044220fc4320044220044220040200000000000000404444444444040000000402814020100804028140200c000000081222428202030a2488102144100000",
        "e0000000ef063bec00000000000404040404040404040404fc000000000000000142c030300c0c8542a15028240949428c102304080000000000000000000040200cc22014422124422444422804433004020000000000000000000f084120022440022440022440048210f0000000000000000000f81022448810213e04081020400000000000000000000f084120022440022440022440048210f0000800013000000000f0410841041144081f4410410841040100000000000000f80812204000073080000102e407000000000000803f0281402010080402810000000000004020044220044220044220044220048210f000",
        "e0000000ef063cd8000000000000000002061424481011224450a0800001000000000000004030280c094322914844929024140a8582616018080400000000000000000000040922820405041428881011141000000000000000814242242418181010101010000000000000fc0102020404040808081010e00f000000000000c00b21841042082184f00000200821082104210401000000e021841042082184107a00000020a0404184882041000000000000000000000000000000000000000000000000fc010000082080000000000000000000000000000000000000000000003c4040407c4242625c000000000002082080",
        "e0000000ef063dc4007a1822904002092490217a000000000000000000000078040202020202047800000000000001041040781126904002092410617801000000000000000000008083882041fe04082084070000000000003841101f4110044110040000000000000000fc224242223c04027c4281433e0002040810a0c3882041820409122408000000000000000220222222020000001000082184104208210700020202024222120a0a162242820000000000444444444444040000000000000000003a87312208094282902024080942821000000000000000000000000000a0c388204182040912240800000000000000",
        "e0000000ef063eb0000000808388204182040922820300000000000000000000007a1822904002092490217a082080000200000000000000781126904002092410617801041040000100000000ba21088220080200000000000000c013080c181008e401000000000000f184104208c10100000000000000204890204182040922c60b000000000000000000100c8a44220a858200000000000000000000006128466224499244290c8310080100000000000000000000004242241818182442420000000000000000100c8a44220a85824010080300000000e0034120080241e003000000000046100441100341100441600000",
        "e0000000ef063f9c10204080000102040810204080000102040810000080412008822030822008421800000000000000008003780000000000000000000000000000c00f2184104208218410420821fc0000000000000000030500000305050006090a00070b130006091e000a0f2700090e3600030544000406490004064f000609550006095e000305670004066c000305720005087700080c7f0006098b00070b9400070b9f00080caa000609b600080cbf00070bcb00080cd600080ce2000305ee000305f3000508f8000609000105080901060911010a0f1a01080c2901070b3501070b4001080c4b010609570106096001",
        "e0000000ef064088080c6901080c75010406810105088701080c8f0106099b010b11a401090eb501090ec301070bd101090edc01080cea010609f6010609ff01080c0802060914020b111d02080c2e02070b3a02070b4502050850020508580205086002070b680206097302070b7c02070b8702070b920206099d02070ba602070bb1020609bc02070bc502070bd0020406db020508e102070be9020406f4020a0ffa02070b0903070b1403070b1f03070b2a030508350306093d0305084603070b4e03070b59030a0f6403070b7303070b7e03060989030508920306099a030508a3030609ab030609b4030a000000010c0900",
        "e0000000ef06417420007f0044670008d176000808000000010c090020007f00ec6f0008147300080409000003070900060e10000a171e00091535000d1e4a000b19680003078100040988000409910009159a000915af000307c400050ccb000409d700050ce0000915ec00091501010915160109152b010b1940010915590109156e0109158301091598010915ad010409c2010409cb010915d4010915e9010915fe01071013020e2023020a1743020a175a020a1771020b1988020915a1020812b6020c1bc8020c1be3020409fe02071007030915170308122c030e203e030c1b5e030c1b7903091594030c1ba9030a17c403",
        "e0000000ef0642600915db030710f0030c1b000409151b040e203004091550040812650409157704050c8c04050c9804050ca4040915b0040710c5040915d5040812ea040a17fc04081213050a17250509153c05060e510508125f050915710504098605050c8f0508129b050409ad050e20b6050915d6050915eb050a1700060a171706060e2e0607103c06050c4c060915580607106d060c1b7d06081298060710aa060710ba06060eca060915d806060eed060915fb060a1710070000000000b06dc30600802d490000000000000012c94ff94b241200000088b72c0e87a61f02000038b1c60afbf98d35d6c8010000000078",
        "e0000000ef06434cd8b0c1c1db3d7bbe01000000b0040000004066333366042066cccc660200d3fe9e070000000000c0303fc3000000000000c01a000000f00f00000000c006000023c68c11030000003c6666666666663c00000000c679188661180000008e0d06c370183e000000000f0cc681c1601e0000000030383834347e30300000008067181e86611e000000380c043e6666663c000000001f0c06c360300c000000003c66663c6666663c000000003c6666667c60301c000000006cc00600006cc01a0000606686611800000000003ff003000000000cc33033030000c083618e011806000000e0c398dd5b2fbdf67e",
        "e0000000ef06443806e007000000183c3c7e667ee7c3000000009fcde6b1d96c3e000000009ec16030180c3c000000003e6666666666663e0000008067189e61181e0000806f189e6118060000007c0606766666667c000000006666667e666666660000006066666606008031c618638cb10300e666361e3e3666e60000008061188661183e000000709ce3bce73def59cd6e760300000000009c39f3e6cd9e3d73e60000000000f8183366cc9831637c00000000009fcd66f3190c0600000000f8183366cc9831637cc0000300001e3636361e363666000000006f180e87e71e0000c0cf300cc3300c00000066666666666666",
        "e0000000ef0645243c000000c03ccfb3e7790c00000098b3ddec6635ab71873bd8000000000000c3663c3c3c3c66c300000080b1cdc6c1603018000000803f0c8761380c7f000000c01b638c31c678006008631843180000e031c618638c3d000006c3239901000000000000000000000000f0030c0c0000000000000000000000c003f3cd663e0000000083c167b3db6d3e0000000000f0c671183c000000188c67bbdd6c3c00000000008067fe1f0c3c00000000677c8661180600000000c06fb3790cbef1d8070083c167b3d96c360000006060666606008001c618638c31030083c1e6f3786c760000006066666606000000",
        "e0000000ef064610008076b6d9669b6db60100000000004067b3d96c3600000000008063bbdf6d1c0000000000c067b3db6d3e83c1000000c067bbdd6c3e180c060000ed8d3106000000007886c7c31e000000986f8c311c00000000c066b3d96c2e0000000000606cb3d9381c000000000000c0ccb6f9e71f33cc000000000000e06ee3706c770000000000606cb3d1381c06c3000000fc18c3183f00008033c6ce618c710000c3300cc3300cc330e018633837c61c000000006f0f000000008027499224491e0000000000000090240902006006000000000010c94fa1fc240200000000e0290a83611e0000008ca850a1cd16",
        "e0000000ef0646fc2a54c400000000001c12120c4a52225e000000280000909424920090449292000041fc8c0400000000000000c88f00000000000000520000000006000000000002008044242201000023499224490c000000a3200882200800008003411042081e00008003410c04410e00000020302824247e20200000008027081e04410e00000027089e24490c00008007410842100400000023498c24490c00000023499207410e0000000400020000040052000000218681400000000000001ee001000000002010184608000000c04188080104000000e043905c4a29a5947e02f00100000004854211f94441000000",
        "e0000000ef0647e8009f48e41189443e000000009e412010080c3c000000003e4242424242423e0000008027089e20081e0000802f08822f08020000007c0202026242427c000000004242427e42424242000000902449020040444444440300914461504844420000008020088220083e000000186698614a2925934c32010000000042464a4a5252624200000000f8081224489020417c00000000008f4824f208040200000000f8081224489020417c40000100008f4824f24844220000008027080606411e0000001f02814020100800000000424242424242423c00000080a04824a250280800000000c428934c4a29a514",
        "e0000000ef0648d42184000000004028310c23492100004028490c82200800008007210821081e0000e0222222220e10224244080070444444440700c3485208000000000000000000007c000402000000000000000000789027491e00000081c0231289441e00000000002e84101c0000001088271289443c0000000000709227081c000080892784100200000000f892e4085e187a0081c0231289442200000010244902004040444444748020488aa14812000090244902000000008077228924924822010000000000c02312894422000000000080231289441c0000000000c0231289441e814000000080271289443c1008",
        "e0000000ef0649c00400e0222202000000270c820e000000f222220e00000040241289443e0000000000849224310c000000000088a84a952a22440000000000004812c3481200000000849224310c410c00808f08111f0000c0442442440c008220088220088220302242242203000000060600000000009f48241289443e000000000080710008306700086c71000800000000ffffff0048124208c00030c000300000000030000fc0000000c0c03030c0003000000000ffffff000000000033c03180300030003f003f003000300030003000ffffffff300c300c318c33cc1ffe013e000780e121fec1f3f03cf8477818000e",
        "e0000000ef064aacc007f8870fff0000ffffff0000000000e001fec1e13870cedc337f801fe007b8016680f13ff8077800000000ffffffff000000000000000000000000000000000000000006000000080000000600000001000000e47d0008a87d000807000000070000000700000001000000247e0008857d0008080000000e0000000e00000001000000b47d0008f07d000809000000040000000700000001000000e47e0008507a00080a000000040000000700000001000000307d0008d87e00080b000000070000000400000001000000bc7d0008577e00080c000000070000000400000001000000087f0008ae7d0008",
        "e0000000ef064b980d000000100000001000000001000000c47d0008787a00080e0000000e0000000e00000001000000b47a0008bf7e00080f0000000e0000000e00000001000000707a0008747e000810000000070000000700000001000000107f0008507e000811000000060000000100000001000000487a0008b17a000812000000100000000a00000001000000647e0008947d000813000000100000000a00000001000000147e0008517d0008140000000e0000000e00000001000000dc7d0008547a0008150000001000000010000000010000001c7e0008657d0008160000000e0000000e000000010000008c7d0008",
        "e0000000ef064c84187f0008170000000e0000000e000000010000005c7e0008a67e0008180000000e0000000e000000010000000c7e0008387d0008190000000e0000000e000000010000006c7e0008ec7e00081a0000000e0000000e00000001000000487e00088d7e00081b0000000e0000000e00000001000000d47d0008987a00081c0000000e0000000e00000001000000cc7d00082c7e00081d0000000e0000000e00000001000000dc7e0008bc7a000800000000ffffff001ffe013e10078cf927fe0132c004f847fe19038ec007f8870ff81f042032407980fd80fd80798032400420f81f0000f00ffc3f7c3e5e7a0e",
        "e0000000ef064d70701e78866186611e780e705e7a7c3efc3ff00f000041110541110501ffffff0000000000f81f0420024c019e01bf01bf019e024c0420f81f804020110a04411105010000ffffff000000000000000000ffffff00ffffff0000000000ffffff0000000000ffffff000000000000000000ffffff0000000000ffffff00190000001ffe013e0007800124808370700ef8413c18060ec007f8870f000000ffffff000000000000000000ffffff0000000000ffffff0000000000ffffff001ffe013e000783e1213000008007f043fc183f0ec007f8870f000000ffffff00000000000804e28f402000088a280800",
        "e0000000ef064e5cffffff000000000000000000ffffff00ffffff00000000001ffe013e00c78ff92786816160181846fe193f0ec007f8870f1ffe013e0c0783e12178003f8007104278181e0ec307f8870f1ffe013e0c0783c120fc001e00030040fc183f0ec007f8870f1ffe013e0047883927fc001e8007f043ce19210ec007f8870f2184240100000000ffffff0000000000ffffff001ffe013e0ae7873123cc003fc01c3046cc993f8ec207f8870f00000000000000ffffff0000000000ffffff001ffe013e000783c12030000c0003004030180c0ec007f8870f002c01010001000200040008001000200040000c001400",
        "e0000000ba064f48010001000100740100018000740174012e02e8025c04d0054407000000010002000300040006000800000000312e3100000302010c5ffc7c26063402051a7bfa1ec3daac1a7a7ba88ebd3b3ccd49743d11a29a1c1ef909138c9ae8cf2d308b1702c234605020601f3045022100a4bd5f9cb9223b34359d75ced4b08ea205c61036ef08caa2899c2d51b31caa510220472e86aa596c17d25767eb87dfd4032229d6f54222a81b1af65203c9923251284646464646464646",
        "e00000000107",
        "e00000000908000000004fffeafd",
        "e00000000509080030c1")
      var offset = 0
      def iterate(): Future[Unit] = {
        sendApdu(HexUtils.decodeHex(mcu11Apdus(offset))) flatMap { (result) =>
          matchErrorsAndThrow(result)
          offset += 1
          if (offset == mcu11Apdus.length) {
            Future.successful()
          } else {
            iterate()
          }
        }
      }
      iterate()
    })

  }

  def validateTargetId(target: Array[Byte]): Future[Unit] = {
    sendApdu(0xE0, 0x04, 0x00, 0x00, 0x00, target.slice(0, 4), 0x00) map {(result) =>
      result.sw match {
        case 0x9000 =>
          ()
        case other =>
          throw LedgerApiUnknownErrorException(other)
      }
    }
  }

  def isBolosInApp(): Future[Boolean] = {
    getFirmwareVersion() flatMap {(version) =>
      validateTargetId(version.targetId)
    } map {(_) =>
      false
    } recover {
        case throwable: LedgerApiException =>
          true
        case other => throw other
      }
    }

  def exchange(command: Array[Byte]): Future[Array[Byte]] = {
    sendApdu(command) map {(result) =>
      matchErrorsAndThrow(result)
      result.data.readNextBytesUntilEnd()
    }
  }

}

object LedgerBolosApi {
  val BolosInApp = 0
  val BolosOnOnboarding = 1

  class FirmwareVersion(reader: BytesReader) {
    val targetId = reader.readNextBytes(4)
    val intTargetId = new BytesReader(targetId).readNextInt()

    var version = "0.0.0"
    var flags: Option[Array[Byte]] = {
        None
    }
    if (reader.available <= 0) {
    }
    else {
      version = new String(reader.readNextBytes(reader.readNextByte()))
      flags = {
        if (reader.available > 0)
          Option(reader.readNextBytes(reader.readNextByte()))
        else
          None
      }
    }
    def isOSU = version.contains("-osu")
    def OSUVersion = version.replace("-osu", "")
    def compareVersion(stringVersion: String): Int = version.compare(stringVersion)
  }

}
